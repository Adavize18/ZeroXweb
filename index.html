<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZeroX Trading Platform</title>

<!-- TradingView Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
/* =================== CSS =================== */
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif;}
body{background:#0e1117;color:#e6e6e6;display:flex;flex-direction:column;min-height:100vh;padding:10px;}
h2,h3{margin-bottom:10px;font-weight:500;}
input,select,button{padding:8px;margin:5px;border-radius:6px;border:none;font-size:14px;}
button{cursor:pointer;background:#238636;color:white;transition:0.2s;}
button:hover{background:#2ea043;}
#chart{height:300px;margin:10px 0;border-radius:8px;overflow:hidden;}

/* Panels */
.panel{background:#161b22;padding:15px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 10px rgba(0,0,0,0.3);}
.trade-panel, .trades, .symbol-tabs{position:relative;}

/* Trades */
.trade{border-bottom:1px solid #30363d;padding:10px 0;transition:0.2s;}
.trade:hover{background:#21262d;}
.trade-info{display:flex;justify-content:space-between;}
.partials{display:flex; gap:5px; opacity:0; transition:0.2s;}
.trade:hover .partials{opacity:1;}
.profit{color:#2ea043;}
.loss{color:#f85149;}

/* Symbol Tabs */
.symbol-tabs button{margin-right:5px;margin-bottom:5px;background:#238636;}
.symbol-tabs button.active{background:#2ea043;}
.category-title{margin-top:10px;font-size:14px;color:#8b949e;}

/* Responsive */
@media (max-width:768px){
  body{padding:5px;}
  input,select,button{font-size:12px;padding:6px;}
  #chart{height:250px;}
}
</style>
</head>
<body>

<h2>ZeroX Trading Platform</h2>

<!-- Signup -->
<div id="signupScreen" class="panel">
  <h3>Sign Up</h3>
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password (8+ chars, letters+numbers+symbols)">
  <button onclick="signup()">Sign Up</button>
</div>

<!-- Login -->
<div id="loginScreen" class="panel">
  <h3>Login</h3>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- Main App -->
<div id="app" style="display:none;">
  <div class="panel">
    Balance: <span id="balance">0</span>
    <button onclick="toggleAccountMode()">Demo</button>
  </div>

  <!-- Symbol Tabs -->
  <div class="panel symbol-tabs" id="symbolSelector"></div>

  <!-- Chart -->
  <div class="panel" id="chart"></div>

  <!-- Trade Panel -->
  <div class="panel trade-panel">
    <h3>Open Trade</h3>
    <select id="pair"></select>
    <input type="number" id="lot" placeholder="Lot Size" value="1">
    <input type="number" id="sl" placeholder="Stop Loss">
    <input type="number" id="tp" placeholder="Take Profit">
    <select id="type">
      <option value="buy">BUY</option>
      <option value="sell">SELL</option>
    </select>
    <button onclick="openTrade()">Open Trade</button>
  </div>

  <!-- Open Trades -->
  <div class="panel trades">
    <h3>Open Trades</h3>
    <div id="tradeList"></div>
  </div>
</div>

<!-- Firebase v12 Modular + App Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyBe8akhSjwzfRzK1UoxskGs_5QyLSHwV8I",
  authDomain: "zerox-8e3f8.firebaseapp.com",
  projectId: "zerox-8e3f8",
  storageBucket: "zerox-8e3f8.firebasestorage.app",
  messagingSenderId: "763704766798",
  appId: "1:763704766798:web:d98587d44aa3d75791ae1f",
  measurementId: "G-D8MECX5L9F"
};

// ===== Initialize Firebase =====
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

// ===== Account Mode =====
let accountMode = "Demo";
function toggleAccountMode(){
  accountMode = accountMode==="Demo"?"Real":"Demo";
  alert("Switched to "+accountMode+" account.");
}

// ===== User Login / Signup =====
let currentUser = null;

async function signup(){
  const email=document.getElementById("signupEmail").value;
  const password=document.getElementById("signupPassword").value;
  const regex=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
  if(!regex.test(password)){alert("Password must be 8+ chars with letters, numbers & symbols");return;}
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,password);
    await sendEmailVerification(userCredential.user);
    alert("Verification email sent!");
    await setDoc(doc(db,"users",userCredential.user.uid),{balance:1000000,trades:[]});
  }catch(err){alert(err.message);}
}

async function login(){
  const email=document.getElementById("loginEmail").value;
  const password=document.getElementById("loginPassword").value;
  try{
    const userCredential = await signInWithEmailAndPassword(auth,email,password);
    if(!userCredential.user.emailVerified){alert("Verify your email first.");return;}
    const userSnap = await getDoc(doc(db,"users",userCredential.user.uid));
    currentUser = {uid:userCredential.user.uid,...userSnap.data()};
    document.getElementById("signupScreen").style.display="none";
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("app").style.display="block";
    initApp();
  }catch(err){alert(err.message);}
}

// ===== Symbols =====
const symbols = {
  "Major Forex": ["EUR/USD","GBP/USD","USD/JPY","AUD/USD","USD/CAD","NZD/USD","USD/CHF"],
  "Minor Forex": ["EUR/GBP","EUR/JPY","GBP/JPY","AUD/JPY","EUR/AUD","AUD/NZD","CAD/JPY"],
  "Crypto": ["BTC/USD","ETH/USD","BNB/USD","XRP/USD","ADA/USD","SOL/USD","DOGE/USD","LTC/USD"],
  "Commodities": ["XAU/USD"]
};

let prices={}, currentSymbol="EUR/USD", candles=[], lastCandleTime=Math.floor(Date.now()/1000);

// ===== Render Symbols =====
function renderSymbols(){
  const container=document.getElementById("symbolSelector");
  container.innerHTML="";
  for(let category in symbols){
    const catDiv=document.createElement("div");
    catDiv.innerHTML=`<span class="category-title">${category}</span> `;
    symbols[category].forEach(sym=>{
      const btn=document.createElement("button");
      btn.innerText=sym;
      btn.onclick=()=>changeSymbol(sym);
      if(sym===currentSymbol) btn.classList.add("active");
      catDiv.appendChild(btn);
    });
    container.appendChild(catDiv);
  }
}
function changeSymbol(sym){
  currentSymbol=sym;
  candles=[];
  updatePairSelect();
  document.querySelectorAll(".symbol-tabs button").forEach(btn=>btn.classList.remove("active"));
  [...document.querySelectorAll(".symbol-tabs button")].find(b=>b.innerText===sym)?.classList.add("active");
}

// ===== Pair select in trade panel =====
function updatePairSelect(){
  const sel=document.getElementById("pair"); sel.innerHTML="";
  for(let cat in symbols) symbols[cat].forEach(s=>sel.appendChild(new Option(s,s)));
}

// ===== Chart Setup =====
const chart = LightweightCharts.createChart(document.getElementById("chart"),{
  layout:{background:{color:"#0e1117"},textColor:"#d1d4dc"},
  grid:{vertLines:{color:"#161b22"},horzLines:{color:"#161b22"}},
  timeScale:{timeVisible:true,secondsVisible:false}
});
const candleSeries = chart.addCandlestickSeries({upColor:"#2ea043",downColor:"#f85149",borderUpColor:"#2ea043",borderDownColor:"#f85149",wickUpColor:"#2ea043",wickDownColor:"#f85149"});

// ===== Price Fetching =====
async function fetchPrice(pair){
  if([].concat(symbols["Major Forex"],symbols["Minor Forex"],symbols["Commodities"]).includes(pair)){
    const res=await fetch(`https://api.exchangerate.host/latest?base=${pair.split('/')[0]}&symbols=${pair.split('/')[1]}`);
    const data=await res.json(); prices[pair]=parseFloat(data.rates[pair.split('/')[1]]);
  }
  if(symbols["Crypto"].includes(pair)){
    const s=pair.split('/')[0].toLowerCase(), c=pair.split('/')[1].toLowerCase();
    const res=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${s}&vs_currencies=${c}`);
    const data=await res.json(); prices[pair]=data[s][c];
  }
}

// ===== Candle Generator =====
async function generateCandle(sym){
  await fetchPrice(sym);
  const open=prices[sym], high=open+Math.random()*0.02, low=open-Math.random()*0.02, close=low+Math.random()*(high-low);
  prices[sym]=close;
  if(sym===currentSymbol){ candles.push({time:lastCandleTime, open, high, low, close}); candleSeries.setData(candles); }
  lastCandleTime+=60;
}

// ===== Trading Functions =====
function openTrade(){
  const pair=document.getElementById("pair").value;
  const lot=parseFloat(document.getElementById("lot").value);
  const type=document.getElementById("type").value;
  const sl=parseFloat(document.getElementById("sl").value);
  const tp=parseFloat(document.getElementById("tp").value);
  const trade={id:Date.now(),pair,lot,remainingLot:lot,entryPrice:prices[pair],type,stopLoss:sl||null,takeProfit:tp||null,profit:0};
  currentUser.trades.push(trade); renderTrades(); saveUserData();
}

function calculateProfit(trade){
  const diff=trade.type==="buy"?prices[trade.pair]-trade.entryPrice:trade.entryPrice-prices[trade.pair];
  return diff*trade.remainingLot*100000;
}

function takePartial(id,percent){
  const trade=currentUser.trades.find(t=>t.id===id); if(!trade)return;
  const cutLot=trade.remainingLot*percent, profitPart=trade.profit*percent;
  currentUser.balance+=profitPart; trade.remainingLot-=cutLot;
  if(trade.remainingLot<=0.001) currentUser.trades=currentUser.trades.filter(t=>t.id!==id);
  document.getElementById("balance").innerText=currentUser.balance.toFixed(2);
  renderTrades();
  saveUserData();
}

function renderTrades(){
  const list=document.getElementById("tradeList"); list.innerHTML="";
  currentUser.trades.forEach(trade=>{
    trade.profit=calculateProfit(trade);
    const div=document.createElement("div"); div.className="trade";
    const cls = trade.profit>=0 ? "profit":"loss";
    div.innerHTML=`<div class="trade-info"><strong>${trade.pair} (${trade.type.toUpperCase()})</strong><span>Lot:${trade.remainingLot.toFixed(2)}</span></div>
    <div class="trade-info"><span>Entry:${trade.entryPrice.toFixed(4)}</span><span class="${cls}">${trade.profit.toFixed(2)}</span></div>
    <div class="trade-info"><small>SL:${trade.stopLoss??"-"}</small><small>TP:${trade.takeProfit??"-"}</small></div>
    <div class="partials">
      <button onclick="takePartial(${trade.id},0.25)">25%</button>
      <button onclick="takePartial(${trade.id},0.5)">50%</button>
      <button onclick="takePartial(${trade.id},0.75)">75%</button>
      <button onclick="takePartial(${trade.id},1)">100%</button>
    </div>`;
    list.appendChild(div);
  });
}

// ===== Save User Data =====
async function saveUserData(){ await setDoc(doc(db,"users",currentUser.uid),currentUser); }

// ===== Market Simulation =====
async function simulateMarket(){
  await generateCandle(currentSymbol);
  for(let sym in prices){ prices[sym]+=(Math.random()-0.5)*0.002; }
  currentUser.trades.forEach(trade=>trade.profit=calculateProfit(trade));
  document.getElementById("balance").innerText=currentUser.balance.toFixed(2);
  renderTrades();
}
setInterval(simulateMarket,1000);

// ===== Initialize App =====
function initApp(){ renderSymbols(); updatePairSelect(); }

</script>

</body>
</html>
